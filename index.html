<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DeepSquid Content Logistics - Phase 1A</title>
  
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Lucide Icons (using Unicode alternatives since lucide needs special handling)
    const Upload = () => <span>üì§</span>;
    const Sparkles = () => <span>‚ú®</span>;
    const Hash = () => <span>#</span>;
    const Check = ({ className }) => <span className={className}>‚úì</span>;
    const X = ({ className }) => <span className={className}>‚úï</span>;
    const AlertTriangle = ({ className }) => <span className={className}>‚ö†</span>;
    const Video = ({ className }) => <span className={className}>üé•</span>;
    const Image = ({ className }) => <span className={className}>üñºÔ∏è</span>;
    
    const DeepSquidContentForm = () => {
      const [originalCaption, setOriginalCaption] = useState('');
      const [hashtags, setHashtags] = useState('');
      const [aiEnhancing, setAiEnhancing] = useState(false);
      const [captions, setCaptions] = useState({
        group1: { ai: '', final: '' },
        group2: { ai: '', final: '' }
      });
      
      const [platforms, setPlatforms] = useState({
        instagram: { enabled: true },
        tiktok: { enabled: true },
        youtube: { enabled: true },
        threads: { enabled: false },
        facebook: { enabled: false },
        linkedin: { enabled: false }
      });

      // PHASE 1A: Hashtag parsing with 5-tag limit
      const parseHashtags = (input) => {
        if (!input) return [];
        return input
          .split(',')
          .map(tag => {
            const cleaned = tag.trim().replace(/[^a-zA-Z0-9]/g, '');
            return cleaned.length >= 2 ? '#' + cleaned.toLowerCase() : '';
          })
          .filter(tag => tag.length > 1)
          .slice(0, 5);
      };
      
      const getTotalCharCount = (caption, hashtagArray) => {
        const hashtagString = hashtagArray.join(' ');
        return caption.length + (hashtagString.length > 0 ? hashtagString.length + 1 : 0);
      };
      
      const getCharStatus = (count, limit) => {
        if (count === 0) return { color: 'text-gray-400' };
        if (count < limit * 0.8) return { color: 'text-green-500' };
        if (count < limit) return { color: 'text-yellow-500' };
        return { color: 'text-red-500' };
      };

      const platformLimits = { group1: 2200, group2: 100 };

      const enhanceWithAI = () => {
        if (!originalCaption.trim()) {
          alert('Please enter a caption first');
          return;
        }
        
        setAiEnhancing(true);
        
        setTimeout(() => {
          const hashtagArray = parseHashtags(hashtags);
          const hashtagString = hashtagArray.join(' ');
          
          const group1Enhanced = `üåÖ‚ú® ${originalCaption} This is absolutely stunning! Who else loves these incredible moments? Drop a üëá if you saw this too!\n\n${hashtagString}`;
          const group2Enhanced = `${originalCaption} ‚ú® ${hashtagString}`.substring(0, 100);
          
          setCaptions({
            group1: { ai: group1Enhanced, final: group1Enhanced },
            group2: { ai: group2Enhanced, final: group2Enhanced }
          });
          
          setAiEnhancing(false);
        }, 2000);
      };

      const handleSubmit = () => {
        if (!originalCaption.trim()) {
          alert('‚ùå Please enter a caption');
          return;
        }
        
        const hashtagArray = parseHashtags(hashtags);
        if (hashtagArray.length > 5) {
          alert(`‚ùå Too many hashtags! You have ${hashtagArray.length}, maximum is 5.\n\nPlease remove ${hashtagArray.length - 5} hashtag(s).`);
          return;
        }
        
        const enabledPlatforms = Object.entries(platforms).filter(([_, config]) => config.enabled);
        if (enabledPlatforms.length === 0) {
          alert('‚ùå Please select at least one platform');
          return;
        }
        
        const payload = {
          originalCaption,
          hashtags: hashtagArray,
          hashtagsRaw: hashtags,
          platforms: enabledPlatforms.map(([name]) => name)
        };
        
        console.log('üì¶ PAYLOAD:', JSON.stringify(payload, null, 2));
        alert('‚úÖ Test successful!\n\nPayload logged to console.\nPress F12 to view details.');
      };

      const hashtagArray = parseHashtags(hashtags);
      const group1Chars = getTotalCharCount(originalCaption, hashtagArray);
      const group1Status = getCharStatus(group1Chars, platformLimits.group1);

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6">
          <div className="max-w-4xl mx-auto">
            {/* Header */}
            <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 mb-6 border border-white/20">
              <div className="flex items-center gap-4">
                <div className="h-16 w-16 bg-gradient-to-br from-cyan-400 to-purple-600 rounded-lg flex items-center justify-center text-3xl">
                  ü¶ë
                </div>
                <div>
                  <h1 className="text-3xl font-bold text-white">DeepSquid Phase 1A Test</h1>
                  <p className="text-white/70 mt-1">Hashtag Limits & Character Counting</p>
                </div>
              </div>
            </div>

            {/* Test Instructions */}
            <div className="bg-blue-500/20 border border-blue-500/30 rounded-xl p-4 mb-6">
              <h3 className="text-blue-200 font-bold mb-3">üß™ TEST INSTRUCTIONS:</h3>
              <div className="text-blue-100 text-sm space-y-2">
                <div className="flex items-start gap-2">
                  <span className="font-bold">1.</span>
                  <span>Type "bondi, sunset, sydney" in hashtags ‚Üí Should show "3/5 hashtags ‚úÖ"</span>
                </div>
                <div className="flex items-start gap-2">
                  <span className="font-bold">2.</span>
                  <span>Type 7 hashtags ‚Üí Should show "7/5 hashtags ‚ùå" in RED</span>
                </div>
                <div className="flex items-start gap-2">
                  <span className="font-bold">3.</span>
                  <span>Click "Enhance with AI" ‚Üí Hashtags appear at bottom</span>
                </div>
                <div className="flex items-start gap-2">
                  <span className="font-bold">4.</span>
                  <span>Try submitting with 7 hashtags ‚Üí Should BLOCK with error</span>
                </div>
              </div>
            </div>

            {/* Caption Input */}
            <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 mb-6 border border-white/20">
              <h2 className="text-xl font-bold text-white mb-4">‚úçÔ∏è Caption</h2>
              
              <textarea
                value={originalCaption}
                onChange={(e) => setOriginalCaption(e.target.value)}
                placeholder="Try: Amazing sunset at Bondi Beach today!"
                className="w-full bg-white/10 border border-white/20 rounded-lg p-4 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-purple-500 min-h-[100px] resize-none"
              />
              
              <div className="mt-4">
                <label className="text-white/90 text-sm font-medium block mb-2">
                  # Hashtags (comma separated, max 5):
                </label>
                <input
                  type="text"
                  value={hashtags}
                  onChange={(e) => setHashtags(e.target.value)}
                  placeholder="Try: bondi, sunset, sydney, beach, australia, summer, ocean"
                  className="w-full bg-white/10 border border-white/20 rounded-lg p-3 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-purple-500"
                />
                
                {/* Hashtag Validation Display */}
                <div className="mt-3 p-3 bg-white/5 rounded-lg border border-white/20">
                  <div className="flex items-center justify-between flex-wrap gap-3">
                    <div>
                      {hashtagArray.length > 5 ? (
                        <span className="text-red-400 font-bold flex items-center gap-2">
                          <AlertTriangle className="w-4 h-4" /> {hashtagArray.length}/5 hashtags - Remove {hashtagArray.length - 5}
                        </span>
                      ) : (
                        <span className={`font-bold flex items-center gap-2 ${
                          hashtagArray.length === 0 ? 'text-white/50' : 
                          hashtagArray.length <= 3 ? 'text-green-400' :
                          hashtagArray.length <= 5 ? 'text-yellow-400' : 'text-red-400'
                        }`}>
                          {hashtagArray.length > 0 && hashtagArray.length <= 5 && <Check className="w-4 h-4" />}
                          {hashtagArray.length > 5 && <X className="w-4 h-4" />}
                          {hashtagArray.length}/5 hashtags
                        </span>
                      )}
                      
                      {hashtagArray.length > 0 && (
                        <div className="text-white/70 text-sm mt-1">
                          Formatted: {hashtagArray.join(' ')}
                        </div>
                      )}
                    </div>
                    
                    <span className={`font-bold ${group1Status.color}`}>
                      {group1Chars}/{platformLimits.group1} chars
                      {group1Status.color.includes('green') && ' ‚úÖ'}
                      {group1Status.color.includes('yellow') && ' ‚ö†Ô∏è'}
                      {group1Status.color.includes('red') && ' ‚ùå'}
                    </span>
                  </div>
                </div>
              </div>
              
              <button
                onClick={enhanceWithAI}
                disabled={aiEnhancing || !originalCaption.trim()}
                className="mt-4 w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-3 rounded-lg transition-all"
              >
                {aiEnhancing ? '‚ö° Enhancing...' : '‚ú® Enhance with AI (Demo)'}
              </button>
            </div>

            {/* AI Enhanced Captions */}
            {captions.group1.ai && (
              <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 mb-6 border border-white/20">
                <h2 className="text-xl font-bold text-white mb-4">üì± AI Enhanced Captions</h2>
                
                <div className="space-y-4">
                  <div>
                    <div className="bg-purple-600/20 border border-purple-500/30 rounded-lg p-3 mb-2">
                      <h3 className="text-white font-bold">Group 1: Instagram ‚Ä¢ TikTok ‚Ä¢ Threads</h3>
                      <span className={`text-sm ${getCharStatus(getTotalCharCount(captions.group1.final, hashtagArray), platformLimits.group1).color}`}>
                        {getTotalCharCount(captions.group1.final, hashtagArray)}/{platformLimits.group1} chars
                      </span>
                    </div>
                    <div className="bg-white/5 rounded-lg p-4 text-white/90 whitespace-pre-wrap text-sm">
                      {captions.group1.ai}
                    </div>
                  </div>

                  <div>
                    <div className="bg-red-600/20 border border-red-500/30 rounded-lg p-3 mb-2">
                      <h3 className="text-white font-bold">Group 2: YouTube Shorts</h3>
                      <span className={`text-sm ${getCharStatus(getTotalCharCount(captions.group2.final, hashtagArray), platformLimits.group2).color}`}>
                        {getTotalCharCount(captions.group2.final, hashtagArray)}/{platformLimits.group2} chars
                      </span>
                    </div>
                    <div className="bg-white/5 rounded-lg p-4 text-white/90 whitespace-pre-wrap text-sm">
                      {captions.group2.ai}
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* Platform Selection */}
            <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 mb-6 border border-white/20">
              <h2 className="text-xl font-bold text-white mb-4">üéØ Platforms</h2>
              <div className="grid grid-cols-3 gap-3">
                {Object.entries(platforms).map(([platform, config]) => (
                  <button
                    key={platform}
                    onClick={() => setPlatforms(prev => ({
                      ...prev,
                      [platform]: { enabled: !prev[platform].enabled }
                    }))}
                    className={`p-3 rounded-lg border-2 font-medium transition-all capitalize ${
                      config.enabled
                        ? 'bg-purple-600/30 border-purple-500 text-white'
                        : 'bg-white/5 border-white/20 text-white/50'
                    }`}
                  >
                    {config.enabled && '‚úÖ '}{platform}
                  </button>
                ))}
              </div>
            </div>

            {/* Submit */}
            <button
              onClick={handleSubmit}
              className="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-4 rounded-lg transition-all text-lg shadow-lg"
            >
              ‚úÖ Test Submit (Press F12 to see payload)
            </button>
            
            <p className="text-white/50 text-sm text-center mt-3">
              Will validate hashtags and show payload in browser console
            </p>
          </div>
        </div>
      );
    };
    
    // Render the app
    ReactDOM.render(<DeepSquidContentForm />, document.getElementById('root'));
  </script>
</body>
</html>
